[toc]
# 计算机组成原理

## 计算机系统概论

### 性能指标

+ 吞吐量 
  >计算机在某一时间间隔内能够处理的信息量
+ 响应时间
  > 从输入有效到系统产生响应之间的时间度量
+ 利用率
  > 在给定的时间间隔内系统被实际使用的时间所占的比例，用百分比表示
+ 处理机字长（机器字长）
  > 处理机运算器中一次能够完成的二进制数运算的位数，如32位，64位
+ 总线宽度
  > CPU中**运算器**与**存储器**之间进行互连的内部总线二进制位数
+ 存储器容量
  > 计算机中的信息用二进制表示，常用的单位有位、字节和字。
  1. 位（bit）：是计算机中最小的数据单位，存放一位二进制数，即0或1。它也是存储器存储信息的最小单位，通常用“b”来表示。
  2. 字节（Byte）：字节是计算机中表示存储容量的最常用的基本单位。一个字节由8位二进制数组成，通常用“B”表示。一个字符占一个字节，一个汉字占两个字节。其它常见的存储单位有：
  存储容量的计量单位有字节B、千字节KB、兆字节MB以及十亿字节GB等。它们之间的换算关系如下：
1KB (Kilobyte 千字节)=1024B
1MB (Megabyte 兆字节 简称“兆”)=1024KB
1GB (Gigabyte 吉字节 又称“千兆”)=1024MB
1TB (Trillionbyte 万亿字节 太字节)=1024GB  
1PB（Petabyte 千万亿字节 拍字节）=1024TB
1EB（Exabyte 百亿亿字节 艾字节）=1024PB
1ZB (Zettabyte 十万亿亿字节 泽字节)= 1024 EB
1YB (Jottabyte 一亿亿亿字节 尧字节)= 1024 ZB
1BB (Brontobyte 一千亿亿亿字节)= 1024 YB
+ 存储器带宽
  > 单位时间从存储器读出的二进制信息量，单位：字节/秒
+ 主频（时钟周期）
  > CPU的工作受主时钟控制，主时钟不断产生固定频率的时钟，主时钟的频率$f$ 叫CPU的主频，单位：MHz（兆赫兹）、GHz

  >主频的倒数为CPU的时钟周期$T$，单位$μs、ns$
+ CPU执行时间
  >CPU执行一般程序所占用的CPU时间：<br/> CPU执行时间=CPU时钟周期数 x CPU时钟周期
+ CPI
  > 每条指令的周期数，执行一条指令的平均时钟周期数： <br/>CPI=执行程序所需CPU时钟周期数 / 程序包含的指令条数
+ MIPS（Million Instructions Per Second）
  > 每秒执行多少百万条定点指令数<br/>MIPS=指令数 / （程序执行时间 x $10^5$）
+ FLOPS（Floating point Operations Per Second）
  >每秒执行浮点操作的次数，衡量机器浮点操作的性能<br/>FLOPS=程序中的浮点操作次数 / 程序执行时间（s）

### 计算机的硬件组成及作用

#### 运算器（ALU算术逻辑运算部件）

##### 功能

1. 算数运算：加减乘除
2. 逻辑运算

#### 存储器

##### 功能

存储原始数据、解题步骤

##### 分类

1. 外存储器：磁盘存储器、光盘存储器
2. 内存储器：半导体存储器（内存）

#### 控制器

>从内存中取出解题步骤加以分析，然后执行某种操作

##### 冯诺依曼结构

指令和数据放在同一个存储器

##### 哈佛结构（计算更快）

指令和数据分别放在两个存储器

#### 基本任务

按照指令序列，从存储器中取出一条指令放到控制器中，对操作码由译码器分析判别，然后根据指令性质，执行这条指令，每取出一条指令，指令计数器就加1

+ 取指周期
  >取指令的时间
+ 执行周期
  > 执行指令的时间

#### 输入输出设备

### 计算机的软件定义及分类

#### 分类

+ 系统程序
  1. 各种服务性程序：诊断、排错、练习程序
  2. 语言程序：汇编、编译、解释程序
  3. 操作系统
  4. 数据库管理系统
+ 应用程序
  1. 工程设计
  2. 数据处理
  3. 自动控制
  4. 企业管理
  ...

### 计算机系统的层次结构

![层次结构](层次结构.jpg)

1. **微程序设计级（电路逻辑级）**：硬件级，由硬件直接执行
2. **一般机器级（机器语言级）**：硬件级，由微程序解释机器指令系统
3. **操作系统级**：混合级，由操作系统实现，操作系统由机器指令和广义指令组成
4. **汇编语言级**：由汇编程序支持和执行，给程序人员提供一种符号形式语言
5. **高级语言级**：面向用户，为方便用户编写应用程序而设置，由高级语言编译程序支持和执行


### 冯诺伊曼机器特点

1. 计算机有运算器、存储器、控制器、输入设备和输出设备五大部件组成
2. 指令和数据以同等地位存放于存储器内，并可按地址访问
3. 指令和数据均可用二进制表示
4. 指令由操作码和地址码组成，操作码表示操作的性质、地址码表示操作数在存储器中的位置
5. 指令在存储器中按顺序存放。通常，指令时顺序执行的。在特殊情况下，可根据运算结果或指定的条件来改变运算顺序
6. 机器以运算器为中心，输入输出设备和存储器之间的数据传送通过运算器完成

### 计算机的分类与应用

1. 多核机
2. 单片机
3. PC机
4. 服务器
5. 大型机
6. 超级计算机


## 运算方法与运算器

### 数据与文字的表示

#### 数据格式

##### 定点数

> 约定机器中所有数据的小数点位置固定不变，通常将数据表示成纯小数或纯整数

$x_n$|$x_{n-1}$  $x_{n-2}$ $\cdots$ $x_0$|
-|-|-|-|-
符号|尾值|

+ 表示**纯小数**，小数点位于$x_n$和$x_{n-1}$之间，$0\leq|x|\leq 1-2^{-n}$
+ 表示**纯整数**，小数点位于$x_0$的右边,$0\leq|x|\leq 2^n-1$

**整数运算**：定点数的运算（计算机多采用定点纯整数）

##### 浮点数

任意一个二进制$N$可以写成
$$N=2^e.M$$

###### 早期计算机标准

$E_s$|$E_{m-1}  \cdots E_1 E_0$|$M_s$|$M_{m-1}$|
-|-|-|-|
|阶符|阶码|数符|尾数

###### IEEE754标准

+ 32位浮点数

31|30  23|22    0|
-|-|-|-|-|-
$S$|$E$|$M$|


+ 64位浮点数

63|62  52|51    0|
-|-|-|-|-|-
$S$|$E$|$M$|

> + S表示符号位，S=0表示正数，S=1表示负数
> + M是尾数，占用23位
> + 小数点放在尾数域最左（最高）有效位的右边
> + E是阶码，占用8位，阶符采用隐含的方式，（移码表示正负指数）

**32位浮点数$x$的真值表示为**
$$
x=(-1)^S × (1.M)×2^{E-127}
$$

**64位浮点数$x$的真值表示为**
$$
x=(-1)^S × (1.M)×2^{E-1023}
$$

##### 十进制数串表示方法

###### 字符串形式

+ 一个字节存放一个十进制形式表示的数据
+ 需要给出在主存中的起始位置、位数
+ 主要用于非数值计算的领域

###### 压缩的十进制数串形式

+ 一个字节存放两个十进制的数位或符号位
+ 节省空间，方便直接完成十进制数的算数运算

#### 数的机器码表示

##### 原码

$$
[x]_原=\begin{cases}
  x,& 2^n>x\ge 0\\
  2^n+|x|=2^n-x, &0\ge x >-2^n
\end{cases}
$$

$x=+1001,[x]_原=01001$
$x=-1001,[x]_原=11001$

+ 优点：简单易懂
+ 缺点：加法运算复杂（解决方法：补码表示法）

##### 补码

$$
[x]_补=\begin{cases}
  x,& 2^n>x\ge 0\\
  2^{n+1}+x=2^{n+1}-|x|, &0\ge x >-2^n
\end{cases}
$$

+ 优点： 减法变为加法
+ 缺点： 求负数的补码需要做减法（解决方法：反码表示法）

##### 总结

1. 正整数时
  三种方法表示相同
2. 负整数时
   1. 原码符号位1不变，整数的每一位二进制数位求反得到反码
   2. 反码的符号位1不变，反码数值位最低加1，得到补码

##### 移码

$$[e]_移=2^k+e,2^k>e\ge -2^k$$

#### 字符与字符串表示法

#### 校验码

设$X=(x_0x_1\cdots x_{n-1})$,$⊕$表示按位加，

##### 奇校验

$$\overline{C}=x_0⊕x_1⊕\cdots ⊕x_{n-1}$$

只有X中包含奇数个1时，才能使$\overline{C}=1$，即$C=0$

##### 偶校验

$$C=x_0⊕x_1⊕\cdots ⊕x_{n-1}$$

只有包含偶数个1时，才使$C=0$

+ **奇偶校验提供奇数个错误检测，无法检测偶数个错误，无法识别错误信息的位置**

### 定点数的运算方法和运算器

#### 算数移位规则

符号位不变

||码制|添补代码|
|-|-|-|
|正数|原码、补码、反码|0|
|负数|原码|0|
|负数|补码|左移添0|
|负数|补码|右移添1|
|负数|反码|1|

#### 补码加法

$$[x]_补+[y]_补=[x+y]_补（mod \ 2^{n+1}）$$

任意两数的补码之和等于该两数之和的补码

#### 补码减法

$$[x-y]_补=[x]_补-[y]_补=[x]_补+[-y]_补$$

$$[-y]_补=\rightharpoondown [y]_补+2^{-n},(包括符号位求反且末位加1)$$

#### 溢出与检测方法

##### 正溢出

> 两个正数相加溢出

##### 负溢出

>两个负数相加溢出

##### 检测方法

1. 双符号位法：两个符号都是0（正数），两个符号位都是1（负数），结果符号位出现01（正溢出） 或10（负溢出） 表示发生溢出

#### 二进制加法/减法器

### 定点乘法运算


#### 原码并行乘法

#### 直接补码并行乘法

### 定点除法运算

#### 恢复余数法

#### 加减交替法（不恢复余数法）

浮点数的运算方法和运算器

## 存储系统

### 概述

#### 存储器分类

##### 按介质分类

1. 半导体存储器 易失
2. 磁表面存储器
3. 磁芯存储器
4. 光盘存储器

##### 按存取方式分类

1. 存取时间与物理地址无关（随机访问）
   + 随机存储器
      >程序执行过程中可读可写
   + 只读存储器
      > 程序执行过程中只读
2. 存取时间与物理地址有关（串行访问）
   + 顺序存取存储器
      >磁带
   + 直接存取存储器
      > 磁盘

##### 按在计算机中的作用

$$
\begin{cases}
  主存储器
  \begin{cases}
    RAM\begin{cases}
      静态RAM\\
      动态RAM
    \end{cases}\\
    ROM\begin{cases}
      MROM\\PROM\\EPROM\\EEPROM
    \end{cases}\\
  \end{cases}\\
  Flash Memory\\
  高速缓冲存储器（Cache）\\
  辅助存储器 & 磁盘、磁带、光盘\\
\end{cases}
$$

#### 存储器的层次结构

##### 存储器的三个主要特性的关系

   速度、容量、价格
![](存储器的层次结构.jpg)

##### 缓存-主存层次和主存-辅存层次

![](缓存_主存层次.png)

### 主存储器

#### 概述

##### 主存的基本组成

![](主存的基本组成.png)

##### 主存和CPU的联系

##### 主存的技术指标

1. 存储容量
   > 主存 存放二进制代码的总位数
2. 存储速度
   + 存取时间：存储器的访问时间、读出时间、写入时间
   + 存取周期：连续两次独立的存储器操作（读或写）所需的**最小间隔时间**、读周期、写周期
3. 存储器的带宽：位/秒

![](主存和CPU的联系.png)

#### 主存储器-半导体芯片

##### 基本结构

![](基本结构.png)

|地址线（单向）|数据线（双向）|芯片容量|
|-|-|-|
|10|4|1K x 4位|
|14|1|16K x 1位|
|13|8|8K x 8位|

###### 片选线

> $\overline{CS}、\overline{CE}$

作用

![](片选线的作用.png)

###### 读写控制线

> $\overline{WE}（低电平写，高电平读）$
$\overline{OE}(允许读)、\overline{允许写}$

##### 译码驱动方式

###### 线选法

![](线选法.png)

###### 重合法

![](重合法.png)

### 随机存取存储器（RAM）

#### 静态RAM（SRAM）

##### 基本电路

![](静态RAM基本电路.png)

###### 读操作

![](静态RAM基本电路读操作.png)

###### 写操作

![](静态RAM基本电路写操作.png)

##### 举例

###### Intel 2114外特性

![](Intel2114.png)

读操作

![](Intel2114读.png)

写操作

![](Intel2114写.png)

#### 动态RAM

##### 基本电路

![](动态RAM基本单元电路.png)

##### 举例

###### 三观动态RAM芯片（Intel 1103）

读操作

![](Intel1103读.png)

写操作

![](Intel1103写.png)

###### 单管动态RAM4116（16K x 1位）外特性

![](4116外特性.png)

读操作

![](4116读操作.png)

写操作
![](4116写.png)

##### 动态RAM刷新

+ 刷新与行地址有关

1. 集中刷新（存取周期为0.5$\mu s$）以128x128矩阵为例
   ![](集中刷新.png)
2. 分散刷新（存取周期为1$\mu s$）
   ![](分散刷新.png)
3. 分散刷新与集中刷新相结合（异步刷新）
对于128x128的存储芯片（存取周期为0.5$\mu s$）
若每隔15.6$\mu s$刷新一行
   ![](分散刷新加异步刷新.png)
每行每隔2ms刷新一次，“死区”为0.5$\mu s$
将刷新安排在指令译码阶段，不会出现“死区”

##### 动态RAM与静态RAM的比较

||DRAM|SRAM|
|-|-|-|
|存储原理|电容|触发器|
|集成度|高|低|
|芯片引脚|少|多|
|功耗|小|大|
|价格|低|高|
|速度|慢|快|
|刷新|有|无|
|用途|主存|缓存|

### 只读存储器（ROM）

#### 掩模ROM（MROM）

行列选择线交叉处有MOS管为“1”
行列选择器交叉处无MOS管为“0”

#### PROM（一次性编程）

![](PROM.png)
熔丝断为“0”
熔丝未断为“1”

#### EPROM（多次性编程）

N型沟道浮动栅MOS电路

![](EPROM.png)

#### EEPROM(多次性编程)

电可擦写
局部擦写
全部擦写

#### Flash Memory（闪速型存储器）

EPROM 价格便宜，集成度高
EEPROM 电可擦写重写
比EEPROM快 具备RAM功能

#### CPU和存储器的连接

##### 存储器容量的扩展

###### 位扩展（增加存储器字长）

![](位扩展.png)

###### 字扩展（增加存储字的数量）

![](字扩展.png)

###### 字、位扩展

![](字位扩展.png)

##### 存储器和CPU的连接

###### 地址线的连接

###### 数据线的连接

###### 读/写命令线的连接

###### 片选线的连接

###### 合理选择存储芯片

###### 其他、时序、负载

#### 存储器的校验

### 高速缓冲存储器

#### 概述

##### 问题提出

+ 避免CPU“空等”现象
+ CPU和主存（DRAM）的速度差异
+ 程序访问局部性原理
![](Cache概述.png)

##### Cache工作原理

###### 主存和缓存的编址

![](主存和Cache.png)

###### 命中与未命中

缓存共有C块
主存共有M块，M >> C

+ 命中
  主存块调入缓存
  主存块与缓存块建立了对应关系
  用**标记语言**与某缓存块建立了对应关系的主存块号
+ 未命中
  主存块未调入缓存
  主存块与缓存块未建立对应关系

###### Cache的命中率

> CPU欲访问的信息在Cache中的比率

+ 命中率与Cache的**容量**和**块长**有关
+ 一般每块大小可取4~8个字
+ 块长取一个存取周期内从主存调出的信息长度

###### Cache-主存系统的效率

效率$e$与命中率有关

$$e=\frac{访问Cache的时间}{平均访问时间}\times 100\%$$
设Cache命中率为$h$,访问Cache的时间为$t_{c}$，访问主存的时间为$t_m$,则
$$e=\frac{t_c}{h\times t_c+(1-h)\times t_m}\times 100\%$$

###### Cache的基本结构

![](Cache基本结构.png)


###### Cache的读写操作

+ 读
  ![](Cache读.png)
+ 写 
  Cache和主存的一致性
  + 写直达法（Write-through）
    写操作时既写入Cache又写入主存
    写操作实践就是访问主存的时间，Cache块退出时，不需要对主存执行写操作，更新策略比较容易实现
  + 写回法（Write-back）
    写操作时只把数据写入Cache而不写入主存
    当Cache数据被替换出去时才写回主存

###### Cache的改进

1. 增加Cache的级数
2. 统一缓存和分立缓存
   指令Cache、数据Cache

#### Cache-主存的地址映射

##### 直接映射

![](直接映射.png)

+ 每个缓存块i只可以和若干个主存块对应
+ 每个主存块j只能和一个缓存块对应

RAM 与 ROM 的种类、特点与工作原理
存贮器与 CPU 的连接
多级存储器系统的基本组成及运行原理
多级存储器所用介质的特性及其多级结构存储器应满足的原则和运行原理
高速存储器的种类、构成

##### 全相联映射

![](全相联映射.png)

##### 组相联映射

![](组相联映射.png)

##### 小结

|方式|特点|
|-|-|
|直接|某一主存块只能固定映射到某一缓存块|
|全相联|某一主存块能映射到任一缓存块|
|组相联|某一主存块只能映射到某一缓存组中的任一缓存块|

#### 替换算法

##### 先进先出（FIFO）算法

##### 近期最少使用（LRU）算法

## 指令系统

### 机器指令

#### 指令的一般格式

|操作码字段|地址码字段|
|-|-|

##### 操作码

> 反映机器做什么操作

###### 长度固定

>用于指令字长较长的情况，RISC

###### 长度可变

>操作码分散在指令字的不同字段

###### 扩展操作码技术

操作码的位数随地址数的减少而增加

![](扩展操作码.png)

+ 三地址指令操作码每减少一种最多课构成$2^4$种二地址指令
+ 二地址指令操作码每减少一种最多课构成$2^4$种二地址指令

##### 地址码

###### 四地址

![](四地址.png)

###### 三地址

![](三地址.png)

###### 二地址

![](二地址.png)

###### 一地址

![](一地址.png)

###### 零地址

无地址码

#### 指令字长

$指令字长取决于\begin{cases}
  操作码的长度\\操作数地址的长度\\操作地址的个数
\end{cases}$

##### 指令字长固定

指令字长=存储字长

##### 指令字长可变

按字节的倍数变化

#### 小结

+ 当用一些硬件资源代替指令字中的地址码字段后
  + 可扩大指令的寻址范围
  + 可缩短指令字长
  + 可减少访存次数
+ 当指令号的地址字段为寄存器时
  + 可缩短指令字长
  + 指令执行阶段可不访存 

### 操作数的类型和操作种类

#### 操作数类型

|地址|无符号整数|
|-|-|
|数字|定点数、浮点数、十进制数|
|字符|ASCII|
|逻辑数|逻辑运算|

#### 数据才存储器中的存放方式

![](数据存储方式.png)

> 字节编址，数据在存储器中的存放方式（存储字长64位，机器字长32位）

##### 从任意位置开始存储

![](从任意位置开始存储.png)

+ 优点：不浪费存储资源
+ 缺点：除了访问第一个字节之外，访问其他任何类型的数据都可能花费两个存储周期的时间，读写控制比较复杂

##### 从一个存储字的起始位置开始访问

![](从起始位置访问.png)

+ 优点：无论访问何种类型的数据，在一个周期内均可完成，读写控制简单
+ 缺点：浪费了宝贵的存储资源

##### 边界对准方式：从地址的整数倍位置开始访问

![](整数倍开始存储.png)

数据存放的起始地址是数据长度（按照编址单位计算）的整数倍

+ 是前两种方法的折中

#### 操作类型

##### 数据传送

![](数据传送.png)

##### 算术逻辑操作

![](算术逻辑操作.png)

##### 移位操作

##### 转移

###### 无条件转移

JMP

###### 条件转移

![](条件转移.png)

###### 调用和返回

![](调用和返回.png)

###### 陷阱（Trap）与陷阱指令

> 意外事故的中断

+ 一般不提供给用户直接使用
+ 设置供用户使用的陷阱指令

##### 输入输出

![](输入输出.png)

### 寻址方式

> 确定本条指令的操作数地址、下一条要执行指令的指令地址

#### 指令寻址

![](指令寻址.png)

#### 数据寻址

![](数据寻址.png)

##### 立即寻址

形式地址A就是操作数

![](立即寻址.png)

+ 指令执行阶段不访存
+ A的位数限制了立即数的范围

##### 直接寻址

EA=A，有效地址由形式地址直接给出

![](直接寻址.png)

+ 执行阶段访问一次存储器
+ A的位数决定了该指令操作数的寻址范围
+ 操作数的地址不易修改（必须修改A）

##### 隐含寻址

![](隐含寻址.png)

+ 指令字中少了一个地址字段，可缩短指令字长

##### 间接寻址

EA=(A),有效地址由形式地址间接提供

###### 一次间接寻址

![](一次间接寻址.png)

+ 执行指令阶段2次访存
+ 可扩大寻址范围
+ 便于编制程序

![](多次间接寻址.png)

+ 多次访存

###### 举例

![](间接寻址举例.png)

##### 寄存器寻址

$EA=R_i$,有效地址即为寄存器编号

![](寄存器寻址.png)

+ 执行阶段不访存，只访问寄存器，执行速度快
+ 寄存器个数有限，可缩短指令字长

##### 寄存器间接寻址

$EA=(R_i)$，有效地址在寄存器中

![](寄存器间接寻址.png)

+ 有效地址在寄存器中，操作数在存储器中，执行阶段需要访问主存
+ 便于编制循环程序

##### 基址寻址

###### 采用专用寄存器作为基址寄存器

EA=(BR)+A, BR为基址寄存器

![](基址寻址.png)

+ 可扩大寻址范围
+ 有利于多道程序
+ BR内容由操作系统或管理程序确定
+ 在程序执行过程中BR内容不变，形式地址A可变

###### 通用寄存器作为基址寄存器

+ 由用户指定由那个通用寄存器作为基址寄存器
+ 基址寄存器的内容由操作系统确定
+ 在程序执行的过程中$R_0$内容不变，形式地址A可变

##### 变址寻址

EA=(IX)+A， IX为变址寄存器（专用）

![](变址寻址.png)

+ 可扩大寻址范围
+ IX的内容由用户给定
+ 在程序执行过程中IX内容可变，形式地址A不变
+ 便于处理数组问题

![](寻址例.png)

##### 相对寻址

EA=(PC)+A
A是相对于当前指令的位移量（可真客服，补码）

![](相对寻址.png)

+ A的位数决定操作数的寻址范围
+ 程序浮动
+ 广泛用于转移指令

##### 堆栈寻址

###### 堆栈特点

$堆栈\begin{cases}
  硬堆栈 & 多个寄存器\\软堆栈 & 指定的存储空间
\end{cases}$

![](堆栈寻址.png)

指令的发展和性能要求；
指令格式基本组成与设计；
指令和数据的寻址方式；
指令系统的设计

## 中央处理器

### CPU的结构

#### CPU的功能

##### 控制器的功能

+ 取指令
+ 分析指令
+ 执行指令，发出各种操作命令
+ 控制程序输入输出及结果的输出
+ 总线管理
+ 处理异常和特殊请求

##### 运算器的功能

+ 实现算术运算和逻辑运算

##### 总结

+ 指令控制
+ 操作控制
+ 时间控制
+ 处理中断
+ 数据加工

#### CPU结构框图

##### CPU与系统总线

![](CPU与系统总线.png)

#### CPU的寄存器

##### 用户可见的寄存器

1. 通用寄存器
   **存放操作数**，可作某种寻址方式所需的专用寄存器
2. 数据寄存器
   **存放操作数**（满足各种数据类型），两个寄存器拼接存放双倍字长数据
3. 地址寄存器
   **存放地址**，其位数应满足最大的地址范围，用于特殊的寻址方式、段基址，栈指针
4. 条件码寄存器
   **存放条件码**，可作为程序分支的依据，如正、负、零、溢出、进位

##### 控制和状态寄存器

###### 控制寄存器

![](控制寄存器.png)

###### 状态寄存器

|状态寄存器|存放条件码|
|-|-|
|PSW寄存器|存放程序状态字|

#### 控制单元CU和中断系统

##### CU

> 产生全部指令的微操作命令序列

|组合逻辑设计|硬连线逻辑|
|-|-|
|微程序设计|存储逻辑|

##### 中断系统

#### ALU

### 指令周期

#### 指令周期的基本概念

##### 指令周期

>去除并执行一条指令所需的全部时间

$完成一条指令\begin{cases}
  取指、分析 & 取址周期\\执行&执行周期
\end{cases}$

![](指令周期基本概念.png)

##### 每条指令的指令周期不同

![](指令周期不同.png)

##### 具有间址周期的指令周期

![](间址周期.png)

##### 带有中断周期的指令周期

![](中断周期.png)

##### 指令周期流程

![](指令周期的流程.png)

##### CPU工作周期的标志

###### CPU访存的四种性质

||||
|-|-|-|
|取|指令|取址周期|
|取|地址|间址周期|
|存取|操作数或结果|执行周期|
|存|程序断点|中断周期|

![](CPU访存.png)

#### 指令周期的数据流

##### 取址周期的数据流

![](取指周期的数据流.png)

##### 间址周期数据流

![](间址周期数据流.png)

##### 执行周期数据流

不同指令的执行周期数据流不同

##### 中断周期数据流

![](中断周期数据流.png)

### 指令流水

#### 如何提高机器速度

##### 提高访存速度

高速芯片、Cache、多体并行

##### 提高I/O和主机之间的传送速度

中断、DMA、通道、I/O处理机、多总线

##### 提高运算器速度

高速芯片、改进算法、快速进位链

##### 提高整机能力

高速部件、改进系统结构，开发系统的并行性

#### 系统的并行性

##### 并行的概念

$并行\begin{cases}
  并发&两个或两个以上时间在同一时间段发生\\同时& 两个或两个以上时间在同一时刻发生
\end{cases}时间上相互重叠$

##### 并行的等级
||||
|-|-|-|
|过程级（程序、进程）|粗粒度|软件实现|
|指令级（指令之间）（指令内部）|细粒度|硬件实现|

#### 指令流水原理

##### 指令的串行执行

![](指令串行执行.png)

##### 指令的二级流水

![](指令的二级流水.png)

##### 影响指令流水效率加倍的因素

1. 执行时间>取指时间
   ![](指令缓冲区.png)
2. 条件转移指令
   必须等上调至零执行结束才能确定下一条指令的地址（解决方法：指令预测）

##### 指令的六级流水

![](六级流水.png)

#### 影响指令流水线性能的因素

##### 结构相关

不同指令争用同一功能不见产生资源冲突
![](指令相关.png)

##### 数据相关

不同指令因重叠操作，，可能改变操作数的读/写访问顺序

![](数据相关.png)


##### 控制相关

![](控制相关.png)

#### 流水线性能

##### 吞吐率

> 单位时间内流水线所完成指令或输出结果的数量，设m段流水线隔段时间为$Δt$

+ 最大吞吐率
  $T_{pmax}=\frac{1}{Δt}$
+ 实际吞吐率
  $T_{p}=\frac{n}{m⋅Δt+(n-1)\cdot Δ t}$

##### 加速比$S_p$

![](加速比.png)

##### 效率

> 流水线中各功能段的利用率

$效率=\frac{流水线隔断处于工作实践的时空区}{流水线中和段总的时空区}=\frac{mn\Delta t}{m(m+n-1)Δt}$

![](效率.png)

#### 流水线的多发技术

##### 超标量技术

+ 每个时钟周期内科并发多条独立指令，配置多个功能部件
+ 不能调整指令的执行顺序，通过编译优化技术，把可并行执行的指令搭配起来

##### 超流水线技术

+ 在一个时钟周期内再分段，一个时钟周期内一个功能部件使用多次

![](超流水技术.png)

+ 不能调整指令的执行顺序，靠编译程序解决优化问题

##### 超长指令字技术

+ 由编译程序挖掘指令间潜在的并行性，将多条能并行操作的指令组合成一条，具有多个操作码字段的超长指令
+ 采用多个处理部件

![](超长指令字.png)

#### 流水线结构

##### 指令流水结构

![](流水线结构.png)

##### 运算流水线

![](运算流水线.png)

### 中断系统

#### 概述

##### 引起中断的各种因素

1. 人为设置的中断
2. 程序性事故：溢出、操作码不能识别、出发非法
3. 硬件故障
4. I/O设备
5. 外部事件：键盘中断现行程序

##### 中断系统需解决的问题

### 微程序设计

#### 设计思想

![](微程序设计思想.png)

#### 微程序控制单元框图及工作原理

##### 机器指令对应的微程序

![](机器指令对应微程序.png)

##### 微程序控制单元基本框图

![](控制单元基本框图.png)

![](工作原理.png)

CPU 的结构和功能；
指令周期、机器周期、时钟周期等基本概念；
微程序控制器的设计及相关基本概念；
传统 CPU、流水 CPU、RISC CPU 的相关概念与技术

## 系统总线

### 总线的基本概念

#### 什么是总线

总线是连接各个部件的信息传输线，是各个部件共享的传输介质

#### 总线上信息的传送

![](总线上信息的传输.png)

#### 总线结构的计算机举例

##### 单总线结构

![](单总线结构.png)

##### 面向CPU的双总线结构框图

![](双总线.png)

##### 以存储器为中心的双总线结构框图

![](存储器双总线.png)

### 总线的分类

#### 片内总线

芯片内部的总线

#### 系统总线

> 计算机各个部件之间信息传输线

![](系统总线.png)

#### 通信总线

> 用于计算机系统之间或计算机系统与其他系统之间的通信

![](传输方式.png)

### 总线特性及性能指标

#### 总线物理实现

![](总线物理实现.png)

#### 总线特性

1. 机械特性（尺寸、形状、管脚数、排列顺序）
2. 电气特性（传输方向和有效的电平范围）
3. 功能特性（每根传输线的功能）
4. 时间特性（信号的时序关系）

#### 总线的性能指标

![](性能指标.png)

### 总线结构

#### 单总线结构

![](单总线结构.png)

#### 多总线结构

##### 双总线结构

![](双总线结构.png)

##### 三总线结构

![](三总线结构.png)

##### 三总线结构又一形式

![](又一结构.png)

##### 四总线结构

![](四总线结构.png)

#### 总线结构举例

##### 传统微型机总线结构

![](传统总线.png)

### 总线控制

#### 总线判优控制

##### 基本概念

+ 主设备：对总线有控制权
+ 从设备：响应从主设备发来的总线命令
+ 总线判优控制
$$\begin{cases}
  集中式\begin{cases}
    链式查询\\计数器定时查询\\独立请求方式
  \end{cases}
  \\分布式
\end{cases}$$

##### 链式查询

![](链式查询.png)

##### 计数器定时查询

![](计数器定时查询.png)

##### 独立请求方式

![](独立请求方式.png)

#### 总线通信控制

##### 目的

解决通信双方协调配合问题

##### 总线传输周期

$\begin{cases}
  申请分配阶段&主模块申请，总线仲裁决定\\寻址阶段& 主模块向从模块给出地址和命令\\传数阶段&主模块和从模块交换数据\\结束阶段&主模块撤销有关信息
\end{cases}$

##### 总线通信的四种方式

$\begin{cases}
  同步通信&由统一时标控制数据传送\\异步通信&采用应答方式，没有时钟标准\\半同步通信&同步、异步结合\\分离式&充分挖掘系统总线每个瞬间潜力
\end{cases}$

###### 同步数据输入

![](同步数据输入.png)

###### 同步数据输出

![](同步数据输出.png)

总线的基本概念；
总线的分类；
总线特性及性能指标；
总线的结构；
总线控制。

## 外部设备

外设的特点及分类；
字符及图形显示器的显示原理及特点；
点阵打印机、激光打印机的成字原理；
磁表面存贮器的记录方式；
硬盘、软盘、磁带的记录格式

## 输入输出系统

外设与 CPU 交换信息的方式、特点及差异；
程序中断方式相关概念与实现原理；
DMA 的相关概念与实现原理