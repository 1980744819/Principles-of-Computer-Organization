[toc]

# 总线

## 总线概述

### 总线基本概念

#### 总线的定义

能为多个部件分时共享的公共信息传输线路

##### 总线的特点

+ 分时
  同一时刻只允许有一个部件向总线发送信息
+ 共享
  总线上可以挂接多个部件，多个部件可同时从总线上接受相同的信息

#### 总线设备

+ 主设备
  获得总线控制权的设备
+ 从设备
  被主设备访问的设备，只能响应主设备发来的各种总线命令

#### 总线特性

+ 机械特性
  尺寸、形状
+ 电气特性
  传输方向和有效的电平范围
+ 功能特性
  每根传输线的功能
+ 时间特性
  信号和时序关系

#### 总线的猝发传输方式

一个周期内传输存储地址连续的多个数据字

### 总线的分类

#### 片内总线

芯片内部的总线

#### 系统总线

计算机系统内各个功能部件之间相互连接的总线

1. 数据总线
   传输各个功能部件之间的数据信息，**双向传输总线**
2. 地址总线
   指出源数据或目的数据所在的主存单元或 IO 端口的地址，**单向传输总线**
3. 控制总线
   传输控制信息

#### 通信总线

计算机系统之间或计算机系统和其他系统之间传送信息的总线，也称**外部总线**

### 系统总线的结构

#### 单总线结构

将 CPU、主存、IO 设备挂在一组总线上

+ 优点：结构简单、成本低、易于接入新的设备
+ 缺点：带宽低、负载重，多个部件只能争用唯一的总线，不支持并发传送操作

#### 双总线结构

1. 主存总线：在 CPU、主存和通道之间传送数据
2. IO 总线：外部设备和通道之间传送数据

+ 优点： 实现了存储请总线和 IO 总线分离
+ 缺点：需要增加通道等硬件设备

#### 三总线结构

1. 主存总线：CPU 和内存之间传送地址、数据和控制信息
2. IO 总线：CPU 和各类外设之间通信
3. DMA 总线：内存和高速外设之间传送数据

+ 优点：提高了 IO 设备的性能，提高系统吞吐量
+ 缺点：系统工作效率低

### 总线的性能指标

1. 总线的传输周期
   一次总线操作所需的时间（申请阶段、寻址阶段、传输阶段、结束阶段）
2. 总线的时钟周期
   机器的时钟周期
3. 总线的工作频率
   总线上各种操作的频率，总线周期的倒数
4. 总线的时钟频率
   机器的时钟频率，时钟周期的倒数
5. 总线宽度
   总线上能够同时传输的数据位数
6. 总线带宽
   总线的数据传输率，单位时间可传输数据的位数
7. 总线复用
   一种信号线在不同的时间传输不同的信息
8. 信号线数
   地址总线、数据总线、控制总线三种总线的总和

## 总线仲裁

解决多个设备同时竞争总线控制权

### 集中仲裁方式

#### 链式查询方式

所有部件共用一根总线请求线，部件请求使用时经过此线发总线请求信号到总线控制器，总线控制器检查总线是否忙，若不忙立即发送总线响应信号，经过总线响应线 BG 串行地从一个部件传送到下一个部件 

+ 部件离总线控制器越近，优先级越高
+ 优点： 优先级固定，结构简单，扩充容易
+ 缺点：对硬件电路故障敏感，优先级不能改变

#### 计数器定时查询方式

采用一个计数器控制总线使用权，相对链式查询多了一组设备地址线，少了一根总线响应线 BG，仍然共用一根地址请求线，当总线收到总线请求并判断总线空闲时，计数器 开始计数，地址线上的计数值与请求使用总线设备的地址一致时，该设备获得总线控制权

+ 优点： 优先级既可以固定，也可以相等，也可以改变次序，对故障不敏感
+ 缺点：增加了控制线数，控制更加复杂

#### 独立请求方式

总线上的部件需要使用总线时，经过各自的总线请求线发送总线请求信号，在总线控制器中排队，总线控制器按一定的优先次序决定批准某个部件的请求，给该部件发送响应信号，该部件受到此信号后获得总线的控制权，开始传送数据

+ 优点： 响应速度快，对优先次序控制灵活
+ 缺点： 控制线数量多，总线控制逻辑更加复杂

### 分布仲裁方式

不需要中央仲裁器，每个潜在的主模块都有自己的仲裁号和仲裁器。有总线请求时，把各自唯一的仲裁号发送到共享的仲裁总线上，每个仲裁器从仲裁总线上得到的仲裁号与自己的仲裁号进行比较，若仲裁总线上的仲裁号优先级高，则它的请求不予响应，并撤销它的仲裁号，获胜者的仲裁号保留在仲裁总线上。

## 总线操作和定时

总线定时：总线在双方交换数据的过程中需要时间上配合关系的控制

### 总线传输的 4 个阶段

1. 申请分配阶段
   使用总线的主设备（主模块提出申请），经过总线仲裁决定下一周期使用权
2. 寻址阶段
   取得使用权的主模块通过总线发出本次要访问的从模块的地址以及相关命令，启动参与本次传输的从模块
3. 传输阶段
   主设备和从设备进行数据交换
4. 结束阶段
   主设备的有关信息均从系统总线上撤除，让出总线使用权

### 同步定时方式

系统采用一个统一的时钟信号协调发送和接受双方的传送定时关系，时钟产生相等的时间间隔，每个间隔构成一个总线周期，一个总线周期中，发送方和接受方可进行一次数据传送

+ 优点：传送速度快，传输速率高，控制逻辑简单
+ 缺点：属于强制性同步，不能及时进行数据通信的有效性检验，可靠性差

### 异步定时方式

没有统一的时钟，也没有相同的时间间隔，依靠双方相互制约的“握手”信号来实现定时控制

+ 优点：总线周期长度可变，保证两个速度相差很大的部件和设备之家安进行可靠的信息交换，自动适应时间的配合
+ 缺点：方式稍微复杂一点，速度比同步定时慢

1. 不互锁方式
2. 半互锁方式
3. 全互锁方式
